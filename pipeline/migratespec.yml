#
# migratespec.yml
#

version: 0.2

env:
  variables:
    deploy_bucket: libra-lambda-deployable

phases:
  install:
    runtime-versions:
      golang: 1.x
#    commands:

  pre_build:
    commands:
      # copy migration scripts
      - mkdir -p scripts && aws s3 cp s3://${deploy_bucket}/latest/scripts scripts --recursive --include *.ksh --quiet
      # install the binary
      - mkdir bin && cd bin && curl -L https://github.com/golang-migrate/migrate/releases/download/v4.17.1/migrate.linux-amd64.tar.gz | tar xvz && chmod +x migrate

  build:
    commands:
      # libra-audit migrations
      - mkdir -p libra-audit/migrations && aws s3 cp s3://${deploy_bucket}/latest/libra-audit/migrations libra-audit/migrations --recursive --include *.sql --quiet
      - scripts/migrate.ksh libra-audit/migrations lambda_audit_migrations up

#  post_build:
#    commands:

#
# end of file
#
